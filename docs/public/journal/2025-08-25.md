# The Right-Click Quest

## The Problem We Faced

moss needed seamless integration with user workflow: right-click any folder → "Publish" appears in the menu → website happens. Without this, moss would be just another app users have to remember to open.

The challenge was deeper than expected. macOS Services require Automator workflows, NSServices registration, Info.plist configuration, and LaunchServices caching. What seemed like a simple context menu entry involved four different system integration points.

## First Attempt: Generate XML

We tried creating Automator workflow XML programmatically. macOS rejected it - malformed, unsigned, untrusted. The system wanted workflows created through official tools, not handcrafted XML.

## Second Approach: Bundle Workflows

Use Automator's UI to create a valid workflow, then bundle it with moss. This worked, but "Publish" appeared in a submenu called "Quick Actions" - one click too many for the elegant experience we wanted.

## The Breakthrough

Old Stack Overflow wisdom saved us: remove `NSIconName` from Info.plist. One XML property deleted, one unnecessary click eliminated.

The difference:

- **With NSIconName**: Right-click → Quick Actions → Publish (2 clicks)
- **Without NSIconName**: Right-click → Publish (1 click)

Such small changes, such large impact on user experience.

## Deep Link Debugging

Even after fixing the context menu, deep links weren't working. The issue: using Tauri's generic event system instead of the dedicated deep link API.

```rust
// Wrong approach
app.listen("deep-link://new-url", |event| { ... });

// Correct approach
app.deep_link().on_open_url(|event| {
    let urls = event.urls();
    // Actually receives events
});
```

## What We Learned

**System integration is different**. You can't mock or simulate macOS Services. The only way to test is to build, install, and try. This makes development slower but ensures compatibility.

**Small details matter enormously**. The difference between a submenu and main menu is one Info.plist property, but it determines whether moss feels polished or clunky.

**Documentation ages quickly**. Tauri v2 changed deep link APIs significantly. Generic event handling no longer works - you need the plugin-specific methods.

## Trade-offs Made

**Bundle Size vs Manual Installation**: We chose to bundle pre-created Automator workflows over generating them dynamically. This added ~50KB but eliminated installation friction.

**System APIs vs User APIs**: Used Tauri's dedicated deep link plugin instead of generic event handling. More specific but more reliable.

**Context Menu Placement**: Removed NSIconName to get main menu placement vs submenu. Lost visual icon but gained one-click access.

## Impact on User Experience

The final integration feels invisible - users right-click folders they're already working with and see "Publish" as a natural option. This removes the context switch that kills momentum in creative workflows.

## Future Implications  

This establishes our system integration philosophy: optimize for user workflow preservation over technical elegance. Integration complexity should be invisible to users.

The automatic installation pattern will extend to other platform features - everything should "just work" after first launch without manual setup.

---

_Technical references:_

- _[Apple Services Guide](https://developer.apple.com/library/archive/documentation/LanguagesUtilities/Conceptual/MacAutomationScriptingGuide/MakeaSystem-WideService.html) - NSServices and workflow integration_
- _[Stack Overflow solution](https://stackoverflow.com/questions/41566158/how-to-add-a-mac-os-service-item-directly-in-the-contextual-menu-instead-of-serv) - Context menu placement for macOS Services_
- _[Tauri Deep Linking Plugin](https://v2.tauri.app/plugin/deep-linking/) - Official API documentation_
