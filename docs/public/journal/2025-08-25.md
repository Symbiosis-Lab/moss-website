# August 25, 2025 - The Right-Click Quest

macOS Services are a maze. We spent the day navigating.

## The Goal

Right-click any folder, see "Publish" in the menu. This sounds simple. The system reality involves Automator workflows, NSServices registration, Info.plist configuration, and LaunchServices caching.

## First Attempt: Generate XML

We tried creating Automator workflow XML programmatically. macOS rejected it - malformed, unsigned, untrusted. The system wanted workflows created through official tools, not handcrafted XML.

## Second Approach: Bundle Workflows

Use Automator's UI to create a valid workflow, then bundle it with moss. This worked, but "Publish" appeared in a submenu called "Quick Actions" - one click too many for the elegant experience we wanted.

## The Breakthrough

Old Stack Overflow wisdom saved us: remove `NSIconName` from Info.plist. One XML property deleted, one unnecessary click eliminated.

The difference:
- **With NSIconName**: Right-click → Quick Actions → Publish (2 clicks)
- **Without NSIconName**: Right-click → Publish (1 click)

Such small changes, such large impact on user experience.

## Deep Link Debugging

Even after fixing the context menu, deep links weren't working. The issue: using Tauri's generic event system instead of the dedicated deep link API.

```rust
// Wrong approach
app.listen("deep-link://new-url", |event| { ... });

// Correct approach  
app.deep_link().on_open_url(|event| {
    let urls = event.urls();
    // Actually receives events
});
```

## What We Learned

**System integration is different**. You can't mock or simulate macOS Services. The only way to test is to build, install, and try. This makes development slower but ensures compatibility.

**Small details matter enormously**. The difference between a submenu and main menu is one Info.plist property, but it determines whether moss feels polished or clunky.

**Documentation ages quickly**. Tauri v2 changed deep link APIs significantly. Generic event handling no longer works - you need the plugin-specific methods.

Now moss installs its workflow on first launch. No configuration needed. The human sees their folder, right-clicks, selects "Publish". The symbiosis is clean.

---

*Technical references:*
- *[Apple Services Guide](https://developer.apple.com/library/archive/documentation/LanguagesUtilities/Conceptual/MacAutomationScriptingGuide/MakeaSystem-WideService.html) - NSServices and workflow integration*
- *[Stack Overflow solution](https://stackoverflow.com/questions/445872/) - Context menu placement with NSIconName*  
- *[Tauri v2 Deep Link Plugin](https://v2.tauri.app/plugin/deep-link/) - Official API documentation*