# Development Journal - August 23, 2025

## Deep Link Protocol Investigation

**Status**: Core functionality works, investigating Finder integration reliability

### Issue: Right-Click Integration Inconsistent

**Problem**: Right-click "Publish to Web" → Automator workflow → `moss://publish?path=...` → No response

### Investigation Results

#### 1. Protocol Registration Discovery
- ✅ `Info.plist` correctly configured with `moss` scheme
- ✅ Browser-initiated deep links trigger confirmation dialog  
- ❌ Terminal `open moss://` commands fail silently
- ❌ Deep link events not reaching Tauri event handler

#### 2. Tauri Deep Link Architecture Learnings
- **Runtime Registration**: `register_all()` only works on Linux/Windows, returns "unsupported platform" on macOS
- **Development Mode**: Protocol registration requires installed `.app` bundle, not available in `npm run tauri dev`
- **Event Flow**: Backend deep link handler → emit event → Frontend IPC → Backend command (not direct function calls)

#### 3. JavaScript Execution Issues Resolved
- **Root Cause**: Added dialog plugin that wasn't properly configured
- **Solution**: Removed dialog plugin completely, reverted to basic `alert()` and `console.log()`
- **Key Learning**: Security over convenience - don't weaken CSP for debugging

#### 4. macOS Protocol Registration Complexity
- Launch Services database doesn't show protocol after standard installation
- Browser vs CLI protocol handling use different mechanisms
- Browser confirmation dialog appears but events don't reach event handler
- System restart may be required for full protocol registration

### Next Steps
- Test after system restart to verify protocol registration
- Consider alternative approaches if protocol registration continues to fail
- Investigate Automator workflow execution independently

### Technical Insights

#### Tauri CSP and Security
- Production builds enforce stricter CSP than development
- `dangerousDisableAssetCspModification` should be avoided
- Use proper Tauri patterns (native dialogs, event system) instead of browser APIs

#### macOS Deep Link Behavior
- Protocol registration happens at app installation, not runtime
- Different behavior between browser-initiated and CLI-initiated protocol calls
- Launch Services database may not reflect all registered protocols